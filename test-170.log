============================================================
==> commandes exécutées
+ REPAS=300
+ debut_restaurant 300 4 2 2
+ : -> debut_restaurant
+ [ 4 -lt 2 ]
+ local duree_repas=300
+ shift
+ local tables=4 2 2
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État initial des shm
État initial des shm
+ cat /tmp/test-170-58240.m1
+ PID_R=58247
+ msleep 40
+ [ 1 != 1 ]
+ local ms=40
+ ./restaurant 300 4 2 2
+ mstos 40
+ [ 1 != 1 ]
+ local ms=40
+ echo scale=5;40/1000
+ bc
+ sleep .04000
+ ps_existe 58247 Le restaurateur n'est plus là
+ [ 2 != 2 ]
+ local pid=58247 msg=Le restaurateur n'est plus là
+ kill -0 58247
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État des shm après création
État des shm après création
+ cat /tmp/test-170-58240.m2
leViandard
+ cmp -s /tmp/test-170-58240.m1 /tmp/test-170-58240.m2
+ : <- debut_restaurant
+ PID_CA=58256
+ msleep 40
+ [ 1 != 1+  ]duree_convive
 A 1+  260local 340 ms=40

+ [ 4 != 4 ]
+ local convive=A arg2=1 min_ms=260 max_ms=340
+ + mstos 40
subsh A
+ [ 1 != 1 ]
+ + [local 1 ms=40 !=
 1 ]
+ local nom=A
+ SUBSH=true
+ exec
+ bc
+ echo scale=5;40/1000
+ sleep .04000
+ PID_CB=58265
+ msleep 40
+ [ 1 != 1 ]
+ local ms=40
+ duree_convive B 1 260 340
+ [ 4 != 4 ]
+ local convive=B arg2=1 min_ms=260 max_ms=340
+ mstos 40
+ [ 1 != 1 ]
+ local ms=40
+ subsh B
+ [ 1 != 1 ]
+ local nom=B
+ SUBSH=true
+ bc+ 
exec
+ echo scale=5;40/1000
+ sleep .04000
+ PID_CC=58274
+ + police_puis_fermeture_restaurant
+ duree_convive: C -> police_puis_fermeture M.X
 0 40
+ [ 0 != 0+  ][
 4 != 4 ]
+ local convive=C arg2=M.X min_ms=0 max_ms=40
+ ./police
+ subsh C
+ [ 1 != 1 ]
+ local nom=C
+ SUBSH=true
+ exec
+ fermeture_restaurant
+ : -> fermeture_restaurant
+ [ 0 != 0 ]
+ PID_F=58279
+ msleep 40
+ [ 1 != 1 ]
+ + local ms=40
./fermeture
+ mstos 40
+ [ 1 != 1 ]
+ local ms=40
+ echo scale=5;40/1000
+ bc
+ sleep .04000
+ ps_termine 58279 'fermeture' aurait dû se terminer rapidement
+ [ 2 != 2 ]
+ local pid=58279 msg='fermeture' aurait dû se terminer rapidement
+ kill -0 58279
+ : <- fermeture_restaurant
+ : <- police_puis_fermeture
+ msleep 300
+ [ 1 != 1 ]
+ local ms=300
+ mstos 300
+ [ 1 != 1 ]
+ local ms=300
+ bc
+ echo scale=5;300/1000
+ sleep .30000
+ fin_restaurant 2 2
+ : -> fin_restaurant
+ [ 2 != 2 ]
+ local nc=2 ng=2
+ ps_termine 58247 Le restaurateur n'a pas terminé
+ [ 2 != 2 ]
+ local pid=58247 msg=Le restaurateur n'a pas terminé
+ kill -0 58247
+ wait 58247
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État des shm à la fin
État des shm à la fin
+ cat /tmp/test-170-58240.m2
+ cmp -s /tmp/test-170-58240.m1 /tmp/test-170-58240.m2
+ grep -q 2 conv /tmp/test-170-58240.r
+ grep -q 2 groupe /tmp/test-170-58240.r
+ : <- fin_restaurant
+ wait 58256
+ wait 58265
+ wait 58274
+ code_retour_convive_ok A Code retour A invalide
+ [ 2 != 2 ]
+ local convive=A msg=Code retour A invalide
+ sed -n s/^code retour=//p /tmp/test-170-58240.cA
+ local r=0
+ [ 0 = 0 ]
+ code_retour_convive_ok B Code retour B invalide
+ [ 2 != 2 ]
+ local convive=B msg=Code retour B invalide
+ sed -n s/^code retour=//p /tmp/test-170-58240.cB
+ local r=0
+ [ 0 = 0 ]
+ code_retour_convive_ok C Refoulement de C != erreur
+ [ 2 != 2 ]
+ local convive=C msg=Refoulement de C != erreur
+ sed -n s/^code retour=//p /tmp/test-170-58240.cC
+ local r=0
+ [ 0 = 0 ]
+ logs_aux
+ set +x
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.cA
Bonjour A vous avez la table 1
code retour=0
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.cB
Bonjour B vous avez la table 2
code retour=0
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.cC
code retour=0
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.f
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.m1
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.m2
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.p
Table 0 : (vide)
Table 1 : A
Table 2 : B

cahier de rappels :
Groupe 4 : B
Groupe 3 : A
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.r
initialisation
init_cahier
allocation salle
creation et ouverture resto
creation restaurant
ouverture_fermeture_restaurant
debut boucle
cpt_dispo
insert_cahier
afficher_cahier
groupe (1) :  A
lancer_chrono
ajuster_tps
initialisation
init_cahier
allocation salle
creation et ouverture resto
creation restaurant
ouverture_fermeture_restaurant
debut boucle
cpt_dispo
insert_cahier
afficher_cahier
groupe (1) :  A
cpt_dispo
insert_cahier
afficher_cahier
groupe (1) :  B
groupe (1) :  A
lancer_chrono
ajuster_tps
initialisation
init_cahier
allocation salle
creation et ouverture resto
creation restaurant
ouverture_fermeture_restaurant
debut boucle
cpt_dispo
insert_cahier
afficher_cahier
groupe (1) :  A
cpt_dispo
insert_cahier
afficher_cahier
groupe (1) :  B
groupe (1) :  A
transmet_police
ouverture_fermeture_restaurant
2 convives servis dans 2 groupes
n_wait
destruction restaurant
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.subsh-A
+ chrono_start
+ [ 0 != 0 ]
+ init_chrono
+ [ ! -x ./chrono ]
+ ./chrono
+ CHRONO_DEBUT=1607211131070.965356
+ ./convive A 1
+ echo code retour=0
+ chrono_stop 260 340 A n'a pas la bonne durée
+ [ 3 != 3 ]
+ local min_ms=260 max_ms=340 msg=A n'a pas la bonne durée
+ ./chrono 1607211131070.965356 260 340
304.392584 ok
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.subsh-B
+ chrono_start
+ [ 0 != 0 ]
+ init_chrono
+ [ ! -x ./chrono ]
+ ./chrono
+ CHRONO_DEBUT=1607211131114.462701
+ ./convive B 1
+ echo code retour=0
+ chrono_stop 260 340 B n'a pas la bonne durée
+ [ 3 != 3 ]
+ local min_ms=260 max_ms=340 msg=B n'a pas la bonne durée
+ ./chrono 1607211131114.462701 260 340
304.607657 ok
============================================================
==> Fichier de log auxiliaire /tmp/test-170-58240.subsh-C
+ chrono_start
+ [ 0 != 0 ]
+ init_chrono
+ [ ! -x ./chrono ]
+ ./chrono
+ CHRONO_DEBUT=1607211131156.876545
+ ./convive C M.X
+ echo code retour=0
+ chrono_stop 0 40 C n'a pas la bonne durée
+ [ 3 != 3 ]
+ local min_ms=0 max_ms=40 msg=C n'a pas la bonne durée
+ ./chrono 1607211131156.876545 0 40
2.268898 ok
============================================================
==> /dev/shm
