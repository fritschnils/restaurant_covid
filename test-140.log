============================================================
==> commandes exécutées
+ REPAS=100
+ DUREE_POLICE=40
+ debut_restaurant 100 4 2
+ : -> debut_restaurant
+ [ 3 -lt 2 ]
+ local duree_repas=100
+ shift
+ local tables=4 2
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État initial des shm
État initial des shm
+ cat /tmp/test-140-58025.m1
+ PID_R=58032
+ msleep 40
+ [ 1 != 1 ]
+ + local ms=40
./restaurant 100 4 2
+ mstos 40
+ [ 1 != 1 ]
+ local ms=40
+ echo scale=5;40/1000
+ bc
+ sleep .04000
+ ps_existe 58032 Le restaurateur n'est plus là
+ [ 2 != 2 ]
+ local pid=58032 msg=Le restaurateur n'est plus là
+ kill -0 58032
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État des shm après création
État des shm après création
+ cat /tmp/test-140-58025.m2
leViandard
+ cmp -s /tmp/test-140-58025.m1 /tmp/test-140-58025.m2
+ : <- debut_restaurant
+ chrono_start
+ [ 0 != 0 ]
+ init_chrono
+ [ ! -x ./chrono ]
+ ./chrono
+ CHRONO_DEBUT=1607211129548.619013
+ ./police
+ chrono_stop 0 40 durée police trop longue
+ [ 3 != 3 ]
+ local min_ms=0 max_ms=40 msg=durée police trop longue
+ ./chrono 1607211129548.619013 0 40
2.193369 ok
+ fermeture_restaurant
+ : -> fermeture_restaurant
+ [ 0 != 0 ]
+ PID_F=58044
+ msleep 40
+ [ 1 != 1 ]
+ local ms=40
+ ./fermeture
+ mstos 40
+ [ 1 != 1 ]
+ local ms=40
+ echo scale=5;40/1000
+ bc
+ sleep .04000
+ ps_termine 58044 'fermeture' aurait dû se terminer rapidement
+ [ 2 != 2 ]
+ local pid=58044 msg='fermeture' aurait dû se terminer rapidement
+ kill -0 58044
+ : <- fermeture_restaurant
+ fin_restaurant 0 0
+ : -> fin_restaurant
+ [ 2 != 2 ]
+ local nc=0 ng=0
+ ps_termine 58032 Le restaurateur n'a pas terminé
+ [ 2 != 2 ]
+ local pid=58032 msg=Le restaurateur n'a pas terminé
+ kill -0 58032
+ wait 58032
+ islinux
+ uname
+ [ xLinux = xLinux ]
+ ls /dev/shm
+ echo État des shm à la fin
État des shm à la fin
+ cat /tmp/test-140-58025.m2
+ cmp -s /tmp/test-140-58025.m1 /tmp/test-140-58025.m2
+ grep -q 0 conv /tmp/test-140-58025.r
+ grep -q 0 groupe /tmp/test-140-58025.r
+ : <- fin_restaurant
+ grep -q able 0.*vide /tmp/test-140-58025.p
+ grep -q able 1.*vide /tmp/test-140-58025.p
+ logs_aux
+ set +x
============================================================
==> Fichier de log auxiliaire /tmp/test-140-58025.f
============================================================
==> Fichier de log auxiliaire /tmp/test-140-58025.m1
============================================================
==> Fichier de log auxiliaire /tmp/test-140-58025.m2
============================================================
==> Fichier de log auxiliaire /tmp/test-140-58025.p
Table 0 : (vide)
Table 1 : (vide)

cahier de rappels :
============================================================
==> Fichier de log auxiliaire /tmp/test-140-58025.r
initialisation
init_cahier
allocation salle
creation et ouverture resto
creation restaurant
ouverture_fermeture_restaurant
debut boucle
transmet_police
ouverture_fermeture_restaurant
0 convives servis dans 0 groupes
n_wait
destruction restaurant
============================================================
==> /dev/shm
